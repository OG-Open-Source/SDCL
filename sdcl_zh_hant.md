# SDCL (OGATA 的標準資料字元儲存語言) 規範

## 1. 範圍

本文件定義了 SDCL（OGATA 的標準資料字元儲存語言）的語法與核心特性。SDCL 旨在作為一種簡潔、人類可讀且機器可解析的資料儲存格式，專為配置管理和資料引用而設計。本規範涵蓋了 SDCL 文件的結構、指派語法及引用機制。

本規範旨在供需要直接格式進行配置的 SDCL 解析器開發者與應用程式開發者使用。SDCL 的設計優先考慮了簡潔性與嚴格性，以確保解析的明確性。

本規範不涉及特定程式語言的 SDCL 解析器實現細節。

## 2. 術語和定義

本文件使用了以下術語和定義：

- **物件（Object）：** 由一組鍵值對組成的無序集合，用花括號 `{}` 表示。
- **陣列（Array）：** 由一系列值組成的有序集合，用方括號 `[]` 表示。
- **鍵（Key）：** 用於識別資料項的名稱。
- **值（Value）：** 與鍵相關聯的資料。所有值都被視為字串。
- **路徑（Path）：** 一個由點（`.`）分隔的鍵序列，用於在 SDCL 文件中唯一標識一個巢狀的值或結構。
- **引用（Reference）：** 一種機制，允許一個值直接連結到同一檔案中或外部來源的另一個值或內容。
- **解析器（Parser）：** 一個軟體組件，負責讀取 SDCL 文件並將其轉換為內部資料結構。

## 3. 符號和縮寫

- **SDCL：** OGATA 的標準資料字元儲存語言。
- **UTF-8：** 一種廣泛使用的 Unicode 字元編碼方案。

## 4. 規範

### 4.1. 文件結構

- **字元編碼：** SDCL 文件**必須**使用 UTF-8 編碼。
- **換行符：** 換行符（`\n`，LF）用於分隔條目。解析器**必須**忽略回車符（`\r`，CR）。
- **縮排：** 縮排**必須**使用定位字元（`\t`）。**不允許**使用空格進行縮排。這確保了所有文件格式的一致性。

### 4.2. 語法規則

- **指派語法：** SDCL 對於指派簡單值與結構化類型使用不同的運算子。

  - **簡單值指派 (`=`):** 為鍵指派值時，**必須**使用等號 (`=`)。
    - `key = value`
  - **結構化類型指派 (`:`):** 為鍵指派物件 (`{...}`) 或陣列 (`[...]`) 時，**必須**使用冒號 (`:`)。
    - `key: { ... }`
    - `key: [ ... ]`

- **鍵（Keys）：**

  - 鍵名**不得**包含空格、點（`.`）或被引號括起來。
  - 完整路徑（例如 `XXX.YYY.ZZZ`）用於表示巢狀結構，其中每個點表示更深一層的巢狀。
  - 在同一物件內，不允許重複的鍵名。若解析器發現重複，**必須**報告錯誤。

- **值（Values）：**

  - 所有值都被視為字面字串，**不得**用引號括起來。
  - 值包含從 `=` 運算子後第一個非空白字元到行尾（註釋前）的所有字元。
  - 解析器**應**修剪值的開頭和結尾的空白。

- **物件與陣列：**

  - 物件由 `key: { ... }` 定義。
  - 陣列由 `key: [ ... ]` 定義。
  - 物件與陣列中的元素由換行符分隔。

- **註釋：**
  - 註釋以井號（`#`）開頭，並延伸至行尾。
  - 註釋**必須**位於其自己的專用行上。不支援行尾註釋。

### 4.3. 引用

SDCL 支援引用以增強資料的可重用性。

- **值引用：**

  - **語法：** `key = (path.to.value)`
  - **目的：** 將另一個鍵的值指派給目前的鍵。

- **內容包含（物件/陣列）：**

  - **語法（不含鍵）：** `(path.to.structure)`
  - **目的：** 將被引用物件或陣列的內容嵌入到目前範圍中。
  - **語法（含鍵）：** `((path.to.structure))`
  - **目的：** 將包括其鍵在內的整個結構嵌入到目前範圍中。

- **外部引用：**
  - **環境變數：** `key = .env.VAR_NAME`
  - **檔案引用：** `key = .path/to/file.sdcl.key`

### 4.4. Front Matter（元資料區塊）

SDCL 支援一個可選的「front matter」區塊，用於在檔案開頭嵌入元資料。

- **語法：** front matter 區塊**必須**位於檔案的第一行，並由僅包含三個連字號 (`---`) 的行包圍。
- **解析：** `---` 分隔符之間的內容被當作標準的 SDCL 文件解析。結尾的 `---` 之後的所有內容都將被 SDCL 解析器忽略。

## 5. SDCL 語法範例

```sdcl
# 這是一個註釋。

# --- 基本指派 ---
application.name = My SDCL App
application.version = 1.2.0
application.enabled = true

# --- 物件指派 ---
server: {
	port = 8080
	host = localhost
}

# --- 陣列指派 ---
features: [
	userManagement
	reporting
	notifications
]

# --- 巢狀結構 ---
database.connection: {
	user = admin
	password = (database.credentials.password) # 值引用
}
database.credentials.password = .env.DB_PASSWORD # 外部引用

# --- 內容包含 ---
default_settings: {
	timeout = 30
	retries = 3
}

service_config: {
	(default_settings) # 包含 timeout 和 retries
	retries = 5        # 覆蓋被包含的值
}

# --- Markdown 文件中的 Front Matter 範例 ---
# ---
# title = 我的文件
# author = Kilo Code
# tags: [ sdcl specs example ]
# ---
# # 主要內容
# SDCL 解析器會忽略這部分。
```

## 6. 結論

本文件提供了 SDCL 資料格式的完整規範。其極簡設計，結合了無引號的值與強大的引用機制，為配置管理提供了一個簡單而有效的解決方案。
