# SDCL (OGATA 的标准数据字符存储语言) 规范

## 1. 范围

本文件定义了 SDCL（OGATA 的标准数据字符存储语言）的语法与核心特性。SDCL 旨在作为一种简洁、人类可读且机器可解析的数据存储格式，专为配置管理和数据引用而设计。本规范涵盖了 SDCL 文件的结构、指派语法及引用机制。

本规范旨在供需要直接格式进行配置的 SDCL 解析器开发者与应用程序开发者使用。SDCL 的设计优先考虑了简洁性与严格性，以确保解析的明确性。

本规范不涉及特定编程语言的 SDCL 解析器实现细节。

## 2. 术语和定义

本文件使用了以下术语和定义：

- **对象（Object）：** 由一组键值对组成的无序集合，用花括号 `{}` 表示。
- **数组（Array）：** 由一系列值组成的有序集合，用方括号 `[]` 表示。
- **键（Key）：** 用于识别数据项的名称。
- **值（Value）：** 与键相关联的数据。所有值都被视为字符串。
- **路径（Path）：** 一个由点（`.`）分隔的键序列，用于在 SDCL 文件中唯一标识一个嵌套的值或结构。
- **引用（Reference）：** 一种机制，允许一个值直接链接到同一文件或外部来源的另一个值或内容。
- **解析器（Parser）：** 一个软件组件，负责读取 SDCL 文件并将其转换为内部数据结构。

## 3. 符号和缩写

- **SDCL：** OGATA 的标准数据字符存储语言。
- **UTF-8：** 一种广泛使用的 Unicode 字符编码方案。

## 4. 规范

### 4.1. 文件结构

- **字符编码：** SDCL 文件**必须**使用 UTF-8 编码。
- **换行符：** 换行符（`\n`，LF）用于分隔条目。解析器**必须**忽略回车符（`\r`，CR）。
- **缩进：** 缩进**必须**使用制表符（`\t`）。**不允许**使用空格进行缩进。这确保了所有文件格式的一致性。

### 4.2. 语法规则

- **指派语法：** SDCL 对于指派简单值与结构化类型使用不同的运算符。

  - **简单值指派 (`=`):** 为键指派值时，**必须**使用等号 (`=`)。
    - `key = value`
  - **结构化类型指派 (`:`):** 为键指派对象 (`{...}`) 或数组 (`[...]`) 时，**必须**使用冒号 (`:`)。
    - `key: { ... }`
    - `key: [ ... ]`

- **键（Keys）：**

  - 键名**不得**包含空格、点（`.`）或被引号括起来。
  - 完整路径（例如 `XXX.YYY.ZZZ`）用于表示嵌套结构，其中每个点表示更深一层的嵌套。
  - 在同一对象内，不允许重复的键名。若解析器发现重复，**必须**报告错误。

- **值（Values）：**

  - 所有值都被视为字面字符串，**不得**用引号括起来。
  - 值包含从 `=` 运算符后第一个非空白字符到行尾（注释前）的所有字符。
  - 解析器**应**修剪值的开头和结尾的空白。

- **对象与数组：**

  - 对象由 `key: { ... }` 定义。
  - 数组由 `key: [ ... ]` 定义。
  - 对象与数组中的元素由换行符分隔。

- **注释：**
  - 注释以井号（`#`）开头，并延伸至行尾。
  - 注释**必须**位于其自己的专用行上。不支持行尾注释。

### 4.3. 引用

SDCL 支持引用以增强数据的可重用性。

- **值引用：**

  - **语法：** `key = (path.to.value)`
  - **目的：** 将另一个键的值指派给当前的键。

- **内容包含（对象/数组）：**

  - **语法（不含键）：** `(path.to.structure)`
  - **目的：** 将被引用对象或数组的内容嵌入到当前范围中。
  - **语法（含键）：** `((path.to.structure))`
  - **目的：** 将包括其键在内的整个结构嵌入到当前范围中。

- **外部引用：**
  - **环境变量：** `key = .env.VAR_NAME`
  - **文件引用：** `key = .path/to/file.sdcl.key`

### 4.4. Front Matter（元数据块）

SDCL 支持一个可选的“front matter”块，用于在文件开头嵌入元数据。

- **语法：** front matter 块**必须**位于文件的第一行，并由仅包含三个连字符 (`---`) 的行包围。
- **解析：** `---` 分隔符之间的内容被当作标准的 SDCL 文件解析。结尾的 `---` 之后的所有内容都将被 SDCL 解析器忽略。

## 5. SDCL 语法示例

```sdcl
# 这是一个注释。

# --- 基本指派 ---
application.name = My SDCL App
application.version = 1.2.0
application.enabled = true

# --- 对象指派 ---
server: {
	port = 8080
	host = localhost
}

# --- 数组指派 ---
features: [
	userManagement
	reporting
	notifications
]

# --- 嵌套结构 ---
database.connection: {
	user = admin
	password = (database.credentials.password) # 值引用
}
database.credentials.password = .env.DB_PASSWORD # 外部引用

# --- 内容包含 ---
default_settings: {
	timeout = 30
	retries = 3
}

service_config: {
	(default_settings) # 包含 timeout 和 retries
	retries = 5        # 覆盖被包含的值
}

# --- Markdown 文件中的 Front Matter 示例 ---
# ---
# title = 我的文件
# author = Kilo Code
# tags: [ sdcl specs example ]
# ---
# # 主要内容
# SDCL 解析器会忽略这部分。
```

## 6. 结论

本文件提供了 SDCL 数据格式的完整规范。其极简设计，结合了无引号的值与强大的引用机制，为配置管理提供了一个简单而有效的解决方案。
